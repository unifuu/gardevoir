{{- $posts := where site.RegularPages "Section" "posts" -}}

{{- /* Calculate post statistics */ -}}
{{- $totalPosts := len $posts -}}
{{- $totalWords := 0 -}}
{{- $totalReadingTime := 0 -}}
{{- $tags := slice -}}

{{- range $posts -}}
    {{- $totalWords = add $totalWords .WordCount -}}
    {{- $totalReadingTime = add $totalReadingTime .ReadingTime -}}
    {{- range .Params.tags -}}
        {{- $tags = $tags | append . -}}
    {{- end -}}
{{- end -}}

{{- $uniqueTags := $tags | uniq -}}

{{- /* API Response */ -}}
{{- $response := dict 
    "meta" (dict 
        "generated" (now.Format "2006-01-02T15:04:05Z07:00")
        "endpoint" "stats"
    )
    "data" (dict 
        "posts" (dict 
            "total" $totalPosts
            "totalWords" $totalWords
            "totalReadingTime" $totalReadingTime
            "averageWordsPerPost" (div $totalWords $totalPosts)
            "tags" (dict 
                "total" (len $uniqueTags)
                "list" $uniqueTags
            )
        )
        "overview" (dict 
            "totalContent" $totalPosts
            "lastUpdated" (site.Lastmod.Format "2006-01-02T15:04:05Z07:00")
        )
    )
-}}

{{- $response | jsonify -}}