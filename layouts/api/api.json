{{- $posts := slice -}}

{{- /* Collect Posts */ -}}
{{- range where site.RegularPages "Section" "posts" -}}
    {{- if not .Params.searchHidden -}}
    {{- $posts = $posts | append (dict 
        "id" .File.UniqueID
        "type" "post"
        "title" .Title 
        "summary" .Summary
        "content" .Plain
        "permalink" .Permalink
        "relativeURL" .RelPermalink
        "date" (.Date.Format "2006-01-02T15:04:05Z07:00")
        "lastmod" (.Lastmod.Format "2006-01-02T15:04:05Z07:00")
        "tags" (.Params.tags | default slice)
        "categories" (.Params.categories | default slice)
        "author" (.Params.author | default "FÅ«")
        "readingTime" .ReadingTime
        "wordCount" .WordCount
        "language" .Language.Lang
        "cover" (dict 
            "image" (.Params.cover.image | default "")
            "alt" (.Params.cover.alt | default .Title)
        )
    ) -}}
    {{- end -}}
{{- end -}}

{{- /* API Response Structure */ -}}
{{- $apiResponse := dict 
    "meta" (dict 
        "version" "1.0"
        "generated" (now.Format "2006-01-02T15:04:05Z07:00")
        "baseURL" site.BaseURL
        "language" site.Language.Lang
        "title" site.Title
        "description" site.Params.description
        "totalPosts" (len $posts)
    )
    "data" (dict 
        "posts" $posts
    )
-}}

{{- $apiResponse | jsonify -}}